# Case Study & Technical Analysis: CAC AP Accrual IR ISO Match Analysis

## Executive Summary
The **CAC AP Accrual IR ISO Match Analysis** is a specialized reconciliation tool designed to solve one of the most complex accounting challenges in Oracle E-Business Suite: reconciling Internal Requisitions (IR) and Internal Sales Orders (ISO). This report bridges the gap between the **Inventory Receipt** (which generates the accrual liability) and the **Intercompany AP Invoice** (which clears that liability). By matching these transactions at the Sales Order Line level, it provides a clear picture of the intercompany accrual balance, identifying missing invoices or receipts that cause period-end write-off issues.

## Business Challenge
Intercompany transfers involve two distinct accounting events that often happen at different times and in different modules:
1.  **Shipment/Receipt:** The receiving organization records a receipt, debiting Inventory and crediting the Intercompany Accrual account.
2.  **Invoicing:** The shipping organization generates an AR invoice, which triggers the creation of an AP invoice in the receiving organization to clear the accrual.

**The Problem:** Standard Oracle reports often struggle to link these two events effectively. If the AP invoice creation fails, is delayed, or is matched incorrectly, the accrual balance remains open indefinitely. Finance teams often spend days manually searching for the corresponding AP invoice for a specific inventory receipt to prove the balance is valid.

## Solution
This report automates the matching process by using the **Internal Sales Order (ISO)** number as the common identifier between the Inventory and Payables modules.
*   **Automated Matching:** Programmatically links `MTL_MATERIAL_TRANSACTIONS` (Receipts) with `AP_INVOICES_ALL` (Invoices) via the Order Management tables.
*   **Variance Detection:** Instantly highlights receipts that have no corresponding AP invoice (Uninvoiced Receipts) and AP invoices that cannot be linked to a receipt.
*   **Detail & Summary Modes:**
    *   **Detail Mode:** Shows every individual receipt and invoice line, perfect for deep-dive investigation.
    *   **Summary Mode:** Aggregates data by Sales Order Line to show the net accrual balance per transaction.

## Technical Architecture
The report employs a complex multi-module join strategy to reconstruct the transaction lifecycle:
*   **Inventory Leg:** Queries `MTL_MATERIAL_TRANSACTIONS` and `CST_MISC_RECONCILIATION` to identify the accrual liability generated by the receipt.
*   **Order Management Leg:** Uses `OE_ORDER_HEADERS_ALL` and `OE_ORDER_LINES_ALL` to traverse from the inventory transaction back to the source order.
*   **Payables Leg:** Queries `AP_INVOICES_ALL` and `AP_INVOICE_LINES_ALL`, looking for invoices referenced by the Internal Sales Order.
*   **Logic:** The SQL handles complex scenarios, including "Intransit Shipments" (FOB Shipment) where the liability is booked upon shipment rather than receipt.

## Parameters & Filtering
*   **Report Mode:** (Mandatory) Choose `Detail` for line-level auditing or `Summary` for high-level balance review.
*   **Transaction Date:** Filter by a specific date range to isolate period-specific issues.
*   **Transaction Type:** Filter by specific inventory transaction types (e.g., 'Internal Order Intr Rcpt').
*   **Category Sets:** Supports reporting by up to three different Item Category Sets (e.g., Inventory, Cost, Purchasing) for flexible grouping.
*   **Organization/Operating Unit:** Filter by specific Inventory Organizations or Operating Units.

## Performance & Optimization
*   **Complexity:** High. This report joins large transaction tables across three major modules (INV, OM, AP).
*   **Optimization:**
    *   Ensure the `Transaction Date` range is reasonable (e.g., one period or quarter) to maintain performance.
    *   Filtering by `Item Number` or `Sales Order` significantly speeds up the query for targeted investigations.

## FAQ
**Q: Why does the report show a "Net Amount" difference?**
A: A difference implies that the amount accrued upon receipt differs from the amount invoiced. This can happen due to price variances, currency exchange rate differences between the receipt date and invoice date, or partial invoicing.

**Q: Does this report handle FOB Shipment vs. FOB Destination?**
A: Yes, the SQL logic (specifically around version 1.7) includes sections to report Intransit Shipments for FOB Shipment scenarios where the order is booked in one OU but shipped from another.

**Q: What should I do with "Unmatched Receipts"?**
A: These represent liabilities that have not been cleared. You should investigate if the "Create Intercompany AP Invoices" program has run successfully or if the invoice is stuck in the AP Interface tables.
